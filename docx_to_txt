import os
import zipfile
from docx import Document
from PIL import Image
import io

# Константы
INPUT_FOLDER = "путь/к/папке/с/docx"  # Укажите путь к исходной папке
OUTPUT_FOLDER = "путь/к/выходной/папке"  # Укажите путь для результатов

def extract_text_from_docx(docx_path):
    """Извлечение текста из DOCX файла"""
    doc = Document(docx_path)
    text = []
    for paragraph in doc.paragraphs:
        if paragraph.text.strip():
            text.append(paragraph.text)
    return '\n'.join(text)

def extract_images_from_docx(docx_path, output_path_base):
    """Извлечение изображений из DOCX файла"""
    with zipfile.ZipFile(docx_path) as docx_zip:
        image_files = []
        for file_info in docx_zip.infolist():
            if file_info.filename.startswith('word/media/'):
                image_files.append(file_info)
        
        for i, image_file in enumerate(image_files, 1):
            image_data = docx_zip.read(image_file)
            img = Image.open(io.BytesIO(image_data))
            img_format = img.format
            output_path = f"{output_path_base}_{i}.{img_format.lower()}"
            img.save(output_path)

def process_docx_files():
    if not os.path.exists(OUTPUT_FOLDER):
        os.makedirs(OUTPUT_FOLDER)

    for filename in os.listdir(INPUT_FOLDER):
        if filename.endswith('.docx'):
            docx_path = os.path.join(INPUT_FOLDER, filename)
            base_name = os.path.splitext(filename)[0]
            output_base = os.path.join(OUTPUT_FOLDER, base_name)

            # Извлечение текста
            text = extract_text_from_docx(docx_path)
            
            if text.strip():
                # Сохранение текста
                with open(f"{output_base}.txt", 'w', encoding='utf-8') as f:
                    f.write("word\n")
                    f.write(text)
            else:
                # Извлечение изображений
                extract_images_from_docx(docx_path, output_base)

if __name__ == "__main__":
    process_docx_files()